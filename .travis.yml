sudo: required
dist: trusty

services:
  - docker

language: cpp

# Compiler selection
compiler:
  - gcc

before_install:
  - wget --no-check-certificate https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest_all.deb
  - sudo dpkg -i cvmfs-release-latest_all.deb
  - sudo apt-get update
  - sudo apt-get install cvmfs cvmfs-config-default
  - rm -f cvmfs-release-latest_all.deb
  - sudo mkdir -p /etc/cvmfs
  - sudo mkdir -p /etc/cvmfs/domain.d
  - sudo mkdir -p /etc/cvmfs/keys/desy.de
  - sudo mkdir -p /etc/cvmfs/keys/cern.ch
  - sudo cp ${PWD}/.travis-ci.d/default.local /etc/cvmfs/default.local
  - sudo cp ${PWD}/.travis-ci.d/desy.de.conf  /etc/cvmfs/domain.d/desy.de.conf
  - sudo cp ${PWD}/.travis-ci.d/cern.ch.conf  /etc/cvmfs/domain.d/cern.ch.conf
  - wget http://grid.desy.de/etc/cvmfs/keys/desy.de.pub
  - sudo mv desy.de.pub /etc/cvmfs/keys/desy.de/desy.de.pub
  - wget http://desy.de/~ebrianne/keys/cern.ch.pub
  - wget http://desy.de/~ebrianne/keys/cern-it1.cern.ch.pub
  - wget http://desy.de/~ebrianne/keys/cern-it4.cern.ch.pub
  - wget http://desy.de/~ebrianne/keys/cern-it5.cern.ch.pub
  - sudo mv cern.ch.pub /etc/cvmfs/keys/cern.ch/cern.ch.pub
  - sudo mv cern.ch.pub /etc/cvmfs/keys/cern.ch/cern-it1.cern.ch.pub
  - sudo mv cern.ch.pub /etc/cvmfs/keys/cern.ch/cern-it4.cern.ch.pub
  - sudo mv cern.ch.pub /etc/cvmfs/keys/cern.ch/cern-it5.cern.ch.pub
  - sudo /etc/init.d/autofs stop
  - sudo cvmfs_config setup
  - sudo mkdir -p /cvmfs/ilc.desy.de
  - sudo mount -t cvmfs ilc.desy.de /cvmfs/ilc.desy.de
  - ls /cvmfs/ilc.desy.de
  - sudo mkdir -p /cvmfs/sft.cern.ch
  - sudo mount -t cvmfs sft.cern.ch /cvmfs/sft.cern.ch
  - ls /cvmfs/sft.cern.ch

# command to install dependencies
install:
  - echo ${PWD}
  - export PKGDIR=${PWD}

# command to run tests
script:
  - docker run -it --name CI_container -v $PKGDIR:/Package -e COMPILER=gcc -v /cvmfs/ilc.desy.de:/cvmfs/ilc.desy.de -v /cvmfs/sft.cern.ch:/cvmfs/sft.cern.ch -d clicdp/slc6-build /bin/bash
  - docker exec -it CI_container /bin/bash -c "./Package/.travis-ci.d/build.sh";
